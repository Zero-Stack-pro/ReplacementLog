{% extends 'base.html' %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - –°–∏—Å—Ç–µ–º–∞ —Å–º–µ–Ω–Ω–æ–≥–æ –∂—É—Ä–Ω–∞–ª–∞{% endblock %}

{% block content %}
<div class="dashboard">
<div class="row">
    <!-- –ö–æ–º–ø–∞–∫—Ç–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
    <div class="col-12 mb-2">
        <div class="welcome-banner">
            <div class="welcome-content">
                <div class="welcome-icon">
                    <i class="bi bi-person-circle"></i>
                </div>
                <div class="welcome-text">
                    <h4 class="welcome-title">
                        –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ employee.user.get_full_name|default:employee.user.username }}!
                    </h4>
                    <div class="welcome-info">
                        <span class="welcome-badge">
                            <i class="bi bi-building"></i> {{ employee.department.name }}
                        </span>
                        <span class="welcome-badge">
                            <i class="bi bi-award"></i> {{ employee.get_position_display }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è -->
    <div class="col-12 mb-3">
        <div class="card h-100">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-list-task"></i> 
                        {% if employee.position == 'admin' %}
                            –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ –æ—Ç–¥–µ–ª–∞–º
                        {% elif employee.position == 'supervisor' %}
                            –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –æ—Ç–¥–µ–ª–∞
                        {% else %}
                            –ú–æ–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
                        {% endif %}
                    </h5>
                    {% if active_tasks %}
                        <span class="badge bg-secondary fs-6" 
                              data-bs-toggle="tooltip" 
                              data-bs-placement="left"
                              data-bs-html="true"
                              title="<div class='text-start'><strong>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</strong><br/>
                                     üìã –í—Å–µ–≥–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á: <strong>{{ active_tasks|length }}</strong><br/>
                                     {% if summary_stats %}
                                         <br/>‚ö†Ô∏è –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ: <strong>{{ summary_stats.total_overdue }}</strong><br/>
                                         üïê –í —Ä–∞–±–æ—Ç–µ: <strong>{{ summary_stats.total_in_progress }}</strong><br/>
                                         ‚è≥ –û–∂–∏–¥–∞—é—Ç: <strong>{{ summary_stats.total_pending }}</strong>
                                     {% endif %}</div>">
                            ?
                        </span>
                    {% endif %}
                </div>
                <!-- –õ–µ–≥–µ–Ω–¥–∞ –¥–ª—è —Ü–≤–µ—Ç–æ–≤–æ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–∏—è -->
                <div class="task-legend mt-2">
                    <small class="text-muted">
                        <i class="bi bi-exclamation-triangle-fill text-danger"></i> –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ
                        <span class="ms-3"><i class="bi bi-clock-fill text-warning"></i> –ù–∞ —Å–µ–≥–æ–¥–Ω—è</span>
                        <span class="ms-3"><i class="bi bi-circle-fill text-muted"></i> –û–±—ã—á–Ω—ã–µ</span>
                        {% if is_admin_view %}
                        <span class="ms-3"><span class="text-secondary fw-bold">?</span> –ù–∞–≤–µ–¥–∏—Ç–µ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</span>
                        {% endif %}
                    </small>
                </div>
            </div>
            <div class="card-body">
                {% if is_admin_view and tasks_by_department %}
                    <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–π - –ø–æ –æ—Ç–¥–µ–ª–∞–º -->
                    {% if tasks_by_department.items %}
                        {% for dept_name, dept_tasks in tasks_by_department.items %}
                    <div class="department-section mb-4" {% if forloop.first %}style="margin-top: 0.5rem;"{% endif %}>
                        <div class="department-header bg-light p-3 rounded mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="text-primary mb-0">
                                    <i class="bi bi-building"></i> {{ dept_name }}
                                </h6>
                                <div class="d-flex align-items-center gap-2">
                                    {% for stat in department_stats %}
                                        {% if stat.name == dept_name %}
                                            <div class="position-relative">
                                                <span class="badge bg-secondary fs-6" 
                                                      data-bs-toggle="tooltip" 
                                                      data-bs-placement="left"
                                                      data-bs-html="true"
                                                      title="<div class='text-start'><strong>{{ dept_name }}</strong><br/>
                                                             üìã –í—Å–µ–≥–æ –∑–∞–¥–∞—á: <strong>{{ stat.total }}</strong><br/>
                                                             ‚ö†Ô∏è –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ: <strong>{{ stat.overdue }}</strong><br/>
                                                             üïê –í —Ä–∞–±–æ—Ç–µ: <strong>{{ stat.in_progress }}</strong><br/>
                                                             ‚è≥ –û–∂–∏–¥–∞—é—Ç: <strong>{{ stat.pending }}</strong></div>">
                                                    ?
                                                </span>
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="tasks-grid">
                            {% for task in dept_tasks %}
                            <div class="task-item {% if task.is_overdue %}task-overdue{% elif task.due_date.date == today %}task-today{% endif %}">
                                <div class="task-content">
                                    <h6>
                                        {% if task.is_overdue %}
                                            <i class="bi bi-exclamation-triangle-fill text-danger me-2"></i>
                                        {% elif task.due_date.date == today %}
                                            <i class="bi bi-clock-fill text-warning me-2"></i>
                                        {% endif %}
                                        {{ task.title }}
                                    </h6>
                                    <div class="mb-2">
                                        <span class="badge bg-{{ task.get_status_color }}">{{ task.get_status_display }}</span>
                                        <span class="badge bg-{{ task.get_priority_color }}">{{ task.get_priority_display }}</span>
                                    </div>
                                    <small class="text-muted d-block">
                                        <strong>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:</strong> 
                                        {% if task.assigned_to %}
                                            {{ task.assigned_to.get_full_name }}
                                        {% else %}
                                            <span class="text-primary fw-bold">–ó–∞–¥–∞—á–∞ –¥–ª—è –≤—Å–µ–≥–æ –æ—Ç–¥–µ–ª–∞</span>
                                        {% endif %}
                                    </small>
                                    <small class="text-muted d-block">
                                        <strong>–°—Ä–æ–∫:</strong> 
                                        <span class="{% if task.is_overdue %}text-danger fw-bold{% elif task.due_date.date == today %}text-warning fw-bold{% endif %}">
                                            {{ task.due_date|date:"d.m.Y H:i" }}
                                        </span>
                                    </small>
                                </div>
                                <div class="task-actions">
                                    <a href="{% url 'shift_log:task_detail' task.pk %}" class="btn btn-outline-primary">
                                        <i class="bi bi-eye"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                        {% endfor %}
                    {% endif %}
                    
                {% elif active_tasks %}
                    <!-- –û–±—ã—á–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                    <div class="tasks-grid">
                        {% for task in active_tasks %}
                        <div class="task-item {% if task.is_overdue %}task-overdue{% elif task.due_date.date == today %}task-today{% endif %}">
                            <div class="task-content">
                                <h6>
                                    {% if task.is_overdue %}
                                        <i class="bi bi-exclamation-triangle-fill text-danger me-2"></i>
                                    {% elif task.due_date.date == today %}
                                        <i class="bi bi-clock-fill text-warning me-2"></i>
                                    {% endif %}
                                    {{ task.title }}
                                </h6>
                                <div class="mb-2">
                                    <span class="badge bg-{{ task.get_status_color }}">{{ task.get_status_display }}</span>
                                    <span class="badge bg-{{ task.get_priority_color }}">{{ task.get_priority_display }}</span>
                                    {% if employee.position in 'admin,supervisor' %}
                                        <span class="badge bg-info">{{ task.department.name }}</span>
                                    {% endif %}
                                </div>
                                <small class="text-muted d-block">
                                    <strong>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:</strong> 
                                    {% if task.assigned_to %}
                                        {{ task.assigned_to.get_full_name }}
                                    {% else %}
                                        <span class="text-primary fw-bold">–ó–∞–¥–∞—á–∞ –¥–ª—è –≤—Å–µ–≥–æ –æ—Ç–¥–µ–ª–∞</span>
                                    {% endif %}
                                </small>
                                <small class="text-muted d-block">
                                    <strong>–°—Ä–æ–∫:</strong> 
                                    <span class="{% if task.is_overdue %}text-danger fw-bold{% elif task.due_date.date == today %}text-warning fw-bold{% endif %}">
                                        {{ task.due_date|date:"d.m.Y H:i" }}
                                    </span>
                                </small>
                            </div>
                            <div class="task-actions">
                                <a href="{% url 'shift_log:task_detail' task.pk %}" class="btn btn-outline-primary">
                                    <i class="bi bi-eye"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-muted text-center py-3">
                        <i class="bi bi-check-circle"></i> 
                        {% if employee.position == 'admin' %}
                            –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ
                        {% elif employee.position == 'supervisor' %}
                            –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π –≤ –≤–∞—à–µ–º –æ—Ç–¥–µ–ª–µ
                        {% else %}
                            –£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
                        {% endif %}
                    </p>
                {% endif %}
            </div>
            <div class="card-footer">
                <a href="{% url 'shift_log:task_list' %}" class="btn btn-primary btn-sm">
                    <i class="bi bi-list-task"></i> –í—Å–µ –∑–∞–¥–∞–Ω–∏—è
                </a>
            </div>
        </div>
    </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ—Ç–¥–µ–ª–∞–º –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ -->
{% if is_admin_view and department_stats %}
<div class="row mb-3">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-graph-up"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ—Ç–¥–µ–ª–∞–º
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for stat in department_stats %}
                    <div class="col-md-3 mb-3">
                        <div class="border rounded p-3 text-center">
                            <h6 class="text-primary mb-2">{{ stat.name }}</h6>
                            <div class="d-flex justify-content-around">
                                <div class="text-center">
                                    <div class="h5 mb-0 text-primary">{{ stat.total }}</div>
                                    <small class="text-muted">–í—Å–µ–≥–æ</small>
                                </div>
                                <div class="text-center">
                                    <div class="h5 mb-0 text-warning">{{ stat.pending }}</div>
                                    <small class="text-muted">–û–∂–∏–¥–∞—é—Ç</small>
                                </div>
                                <div class="text-center">
                                    <div class="h5 mb-0 text-info">{{ stat.in_progress }}</div>
                                    <small class="text-muted">–í —Ä–∞–±–æ—Ç–µ</small>
                                </div>
                                {% if stat.overdue > 0 %}
                                <div class="text-center">
                                    <div class="h5 mb-0 text-danger">{{ stat.overdue }}</div>
                                    <small class="text-muted">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω—ã</small>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á—ë—Ç –∏ —Å–ø–∏—Å–∞–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ -->
{% if employee.position != 'admin' %}
<div class="row mb-3">
    <div class="col-md-6 mb-3">
        <!-- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á—ë—Ç –æ—Ç–¥–µ–ª–∞ -->
        <div class="card h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-journal-text"></i> –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á—ë—Ç –æ—Ç–¥–µ–ª–∞</h5>
            </div>
            <div class="card-body">
                <form method="post" action="" enctype="multipart/form-data">
                    {% csrf_token %}
                    

                    
                    {{ daily_report_form.comment.label_tag }}
                    {{ daily_report_form.comment }}
                    {% if daily_report_form.comment.errors %}
                        <div class="text-danger small">{{ daily_report_form.comment.errors }}</div>
                    {% endif %}
                    
                    <div class="mt-3">
                        <label for="{{ daily_report_form.photo.id_for_label }}" class="form-label">
                            <i class="bi bi-camera"></i> {{ daily_report_form.photo.label }}
                        </label>
                        {{ daily_report_form.photo }}
                        {% if daily_report_form.photo.errors %}
                            <div class="text-danger small">{{ daily_report_form.photo.errors }}</div>
                        {% endif %}
                        <small class="text-muted">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10MB. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: JPG, PNG, GIF</small>
                    </div>
                    
                    <div class="mt-3">
                        <label for="{{ daily_report_form.photo_caption.id_for_label }}" class="form-label">
                            <i class="bi bi-chat-text"></i> {{ daily_report_form.photo_caption.label }}
                        </label>
                        {{ daily_report_form.photo_caption }}
                        {% if daily_report_form.photo_caption.errors %}
                            <div class="text-danger small">{{ daily_report_form.photo_caption.errors }}</div>
                        {% endif %}
                        <small class="text-muted">–ü–æ–¥–ø–∏—Å—å –∫ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</small>
                    </div>
                    
                    <button type="submit" name="daily_report_submit" class="btn btn-primary mt-3">
                        <i class="bi bi-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </form>
                
                <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π -->
                {% if daily_report.photos.all %}
                <div class="mt-4">
                    <h6><i class="bi bi-images"></i> –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –æ—Ç—á–µ—Ç–∞</h6>
                    <div class="row">
                        {% for photo in daily_report.photos.all %}
                            {% if photo.file_exists %}
                            <div class="col-md-6 mb-3">
                                <div class="card">
                                    <img src="{{ photo.image.url }}" class="card-img-top" alt="–§–æ—Ç–æ –æ—Ç—á–µ—Ç–∞" 
                                         style="max-height: 200px; object-fit: cover;">
                                    <div class="card-body p-2">
                                        {% if photo.caption %}
                                            <p class="card-text small mb-1">{{ photo.caption }}</p>
                                        {% endif %}
                                        <small class="text-muted">
                                            –ó–∞–≥—Ä—É–∂–µ–Ω–æ: {{ photo.uploaded_at|date:'d.m.Y H:i' }}
                                        </small>
                                    </div>
                                </div>
                            </div>
                            {% else %}
                            <div class="col-md-6 mb-3">
                                <div class="card">
                                    <div class="card-body text-center text-muted">
                                        <i class="bi bi-image" style="font-size: 3rem;"></i>
                                        <p class="mt-2 mb-1">–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω</p>
                                        <small>{{ photo.get_filename }}</small>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
            <div class="card-footer text-end text-muted small">
                –ó–∞ {{ daily_report.date|date:'d.m.Y' }} | –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: {{ daily_report.updated_at|date:'d.m.Y H:i' }}
            </div>
        </div>
    </div>
    <div class="col-md-6 mb-3">
        <!-- –°–ø–∏—Å–∞–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ -->
        <div class="card h-100">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="bi bi-box-arrow-down"></i> –°–ø–∏—Å–∞–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (–∑–∞ —Å–µ–≥–æ–¥–Ω—è)</h5>
            </div>
            <div class="card-body">
                {% if writeoffs %}
                <table class="table table-bordered table-sm">
                    <thead>
                        <tr>
                            <th>–ß—Ç–æ</th>
                            <th>–°–∫–æ–ª—å–∫–æ</th>
                            <th>–ï–¥.–∏–∑–º</th>
                            <th>–ö—É–¥–∞</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for w in writeoffs %}
                        <tr>
                            <td>{{ w.material_name }}</td>
                            <td>{{ w.quantity }}</td>
                            <td>{{ w.get_unit_display }}</td>
                            <td>{{ w.destination }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="text-muted">–ù–µ—Ç —Å–ø–∏—Å–∞–Ω–∏–π –∑–∞ —Å–µ–≥–æ–¥–Ω—è.</div>
                {% endif %}
                <div class="mt-2 text-end">
                    <a href="{% url 'shift_log:material_writeoff_list' %}" class="btn btn-outline-success btn-sm">
                        <i class="bi bi-list"></i> –í—Å–µ —Å–ø–∏—Å–∞–Ω–∏—è
                    </a>
                    <a href="{% url 'shift_log:material_writeoff_create' %}" class="btn btn-success btn-sm ms-2">
                        <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
<div class="row mb-3">
    <div class="col-lg-6">
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div class="card h-100">
            <div class="card-header bg-warning text-dark">
                <h5 class="card-title mb-0">
                    <i class="bi bi-bell-fill"></i> –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                </h5>
            </div>
            <div class="card-body">
                {% if notifications %}
                    {% for notification in notifications %}
                    <div class="notification-item mb-3 p-3 border-start border-warning border-4 bg-light">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <h6 class="mb-1 fw-bold">
                                    {% if notification.is_task_related and notification.get_task_url %}
                                        <a href="{{ notification.get_task_url }}" class="text-decoration-none">
                                            {{ notification.title }}
                                            <i class="bi bi-arrow-right-circle ms-1"></i>
                                        </a>
                                    {% else %}
                                        {{ notification.title }}
                                    {% endif %}
                                </h6>
                                <p class="mb-2 text-muted">{{ notification.message }}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        <i class="bi bi-clock"></i> {{ notification.sent_at|timesince }} –Ω–∞–∑–∞–¥
                                    </small>
                                    <div class="d-flex align-items-center gap-2">
                                        {% if not notification.is_read %}
                                            <span class="badge bg-danger">–ù–æ–≤–æ–µ</span>
                                        {% endif %}
                                        {% if notification.is_task_related and notification.get_task_url %}
                                            <a href="{{ notification.get_task_url }}" class="btn btn-sm btn-outline-primary">
                                                <i class="bi bi-eye"></i> –ü–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞–¥–∞—á–µ
                                            </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% if not notification.is_read %}
                            <button class="btn btn-sm btn-outline-success mark-read ms-2" 
                                    data-notification-id="{{ notification.id }}"
                                    title="–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ">
                                <i class="bi bi-check-lg"></i>
                            </button>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-bell-slash text-muted" style="font-size: 2rem;"></i>
                        <p class="text-muted mt-2">–ù–µ—Ç –Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p>
                    </div>
                {% endif %}
            </div>
            <div class="card-footer">
                <a href="{% url 'shift_log:notifications_list' %}" class="btn btn-warning btn-sm">
                    <i class="bi bi-bell"></i> –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                </a>
                {% if notifications %}
                <button class="btn btn-outline-secondary btn-sm ms-2 mark-all-read">
                    <i class="bi bi-check-all"></i> –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
                </button>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-lightning"></i> –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
                </h5>
            </div>
            <div class="card-body">
                <div class="d-flex gap-2 flex-wrap">
                    {% if employee.position in 'admin,supervisor' %}
                        <a href="{% url 'shift_log:task_create' %}" class="btn btn-success flex-fill text-nowrap">
                            <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
                        </a>
                        <a href="{% url 'shift_log:task_list' %}" class="btn btn-warning flex-fill text-nowrap">
                            <i class="bi bi-list-task"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è–º–∏
                        </a>
                    {% endif %}
                    <a href="/admin/" class="btn btn-secondary flex-fill text-nowrap">
                        <i class="bi bi-gear"></i> –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
                    </a>
                    {% if employee.position == 'admin' %}
                        <a href="{% url 'shift_log:material_writeoff_list' %}" class="btn btn-success flex-fill text-nowrap">
                            <i class="bi bi-box-arrow-down"></i> –í—Å–µ —Å–ø–∏—Å–∞–Ω–∏—è
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
</div>
{% endblock %}

{% block extra_js %}
<!-- –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ main.js -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Bootstrap
    if (typeof bootstrap !== 'undefined' && bootstrap.Tooltip) {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è tooltip'–æ–≤ Bootstrap
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl, {
                html: true,
                placement: 'left',
                trigger: 'hover focus'
            });
        });
    } else {
        // Fallback: —Å–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—ã–µ tooltip'—ã
        console.log('Bootstrap tooltips not available, creating custom tooltips');
        
        var tooltipElements = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        tooltipElements.forEach(function(element) {
            var title = element.getAttribute('title');
            if (title) {
                element.setAttribute('data-original-title', title);
                element.removeAttribute('title');
            }
        });
    }
});
</script>
{% endblock %}

{% block extra_css %}
<style>
.card {
    transition: box-shadow 0.3s cubic-bezier(.4,0,.2,1), border-color 0.3s cubic-bezier(.4,0,.2,1), transform 0.3s cubic-bezier(.4,0,.2,1);
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    border: 1px solid #e0e0e0;
    will-change: box-shadow, transform;
    border-radius: 1rem;
}
.card:hover {
    border-color: #e0e0e0 !important;
    box-shadow: 0 6px 24px rgba(0,0,0,0.10);
    transform: scale(1.015);
}
/* –û—Ç–∫–ª—é—á–∞–µ–º —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –∏ —Ç–µ–Ω—å –¥–ª—è —Å—Ç—Ä–æ–∫ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
.table-hover > tbody > tr:hover {
    transform: none !important;
    box-shadow: none !important;
    background-color: rgba(0, 123, 255, 0.05);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–¥–∞—á –ø–æ –æ—Ç–¥–µ–ª–∞–º */
.department-section {
    margin-bottom: 2rem;
}

.department-header {
    border: 1px solid #e9ecef;
    background: #f8f9fa;
    border-radius: 0.75rem;
    margin-bottom: 1rem;
}

.department-header h6 {
    font-weight: 600;
    color: #495057;
    font-size: 1.1rem;
}

.tasks-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 1.25rem;
    margin-top: 0;
}

.task-item {
    background: #fff;
    border: 1px solid #e9ecef;
    border-radius: 0.75rem;
    padding: 1.25rem;
    transition: all 0.2s ease;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    position: relative;
}

.task-item:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    transform: translateY(-1px);
    border-color: #007bff;
}

.task-item.task-overdue {
    border-left: 4px solid #dc3545;
    background: #fff5f5;
}

.task-item.task-today {
    border-left: 4px solid #ffc107;
    background: #fffbf0;
}

.task-content h6 {
    color: #495057;
    font-weight: 600;
    margin-bottom: 0.75rem;
    font-size: 1rem;
    line-height: 1.4;
}

.task-actions {
    margin-top: 1rem;
    padding-top: 0.75rem;
    border-top: 1px solid #f1f3f4;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
@media (max-width: 768px) {
    .tasks-grid {
        grid-template-columns: 1fr;
    }
    
    .department-section {
        margin-left: 0;
        padding-left: 0.5rem;
    }
    
.department-header .d-flex {
    flex-direction: column;
    align-items: flex-start !important;
    gap: 0.5rem;
}

/* –£–ª—É—á—à–µ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
.department-header .badge,
.card-header .badge {
    font-size: 0.8rem;
    padding: 0.4rem 0.6rem;
    border-radius: 0.4rem;
    font-weight: 500;
    cursor: help;
    transition: all 0.2s ease;
}

.department-header .badge:hover,
.card-header .badge:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    background-color: #6c757d !important;
}

.department-header .badge i,
.card-header .badge i {
    font-size: 1rem;
}

/* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–∏–º–≤–æ–ª–∞ –≤–æ–ø—Ä–æ—Å–∞ */
.department-header .badge,
.card-header .badge {
    font-family: 'Bootstrap Icons', sans-serif;
    font-weight: bold;
    font-size: 1.1rem;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è tooltip */
.tooltip {
    font-size: 0.875rem;
}

.tooltip-inner {
    text-align: left;
    max-width: 200px;
    padding: 0.75rem;
    background-color: #2c3e50;
    border-radius: 0.5rem;
}

.tooltip.bs-tooltip-left .tooltip-arrow::before {
    border-left-color: #2c3e50;
}

/* Fallback CSS tooltip –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ Bootstrap –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç */
.department-header .badge[data-bs-toggle="tooltip"]:hover::after,
.card-header .badge[data-bs-toggle="tooltip"]:hover::after {
    content: attr(data-original-title);
    position: absolute;
    left: 100%;
    top: 50%;
    transform: translateY(-50%);
    margin-left: 10px;
    background-color: #2c3e50;
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 0.8rem;
    white-space: nowrap;
    z-index: 1000;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    pointer-events: none;
    opacity: 0;
    animation: fadeInTooltip 0.3s ease forwards;
}

@keyframes fadeInTooltip {
    from {
        opacity: 0;
        transform: translateY(-50%) translateX(-5px);
    }
    to {
        opacity: 1;
        transform: translateY(-50%) translateX(0);
    }
}

.department-header .d-flex.gap-2 {
    gap: 0.5rem !important;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .department-header .d-flex {
        flex-direction: column;
        align-items: flex-start !important;
        gap: 0.75rem;
    }
    
    .department-header .d-flex.gap-2 {
        flex-direction: row;
        flex-wrap: wrap;
    }
}
}
</style>
{% endblock %} 